<li class="nav-item dropdown">
    <button
        id="irsim-lang-toggle"
        class="btn btn-outline-secondary btn-sm px-2 py-1 dropdown-toggle"
        type="button"
        data-bs-toggle="dropdown"
        aria-expanded="false"
    >
        üåê <span id="irsim-lang-label">Language</span>
    </button>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="irsim-lang-toggle">
        <li><button class="dropdown-item" type="button" onclick="irsimSwitchLang('en')">English</button></li>
        <li><button class="dropdown-item" type="button" onclick="irsimSwitchLang('zh_CN')">‰∏≠Êñá</button></li>
    </ul>
</li>

<script>
    (function () {
        const current = irsimDetectLang();
        const label = document.getElementById('irsim-lang-label');
        if (label) {
            label.textContent = current === 'zh_CN' ? '‰∏≠Êñá' : 'English';
        }
    })();

    function irsimDetectLang() {
        const path = window.location.pathname;
        return (path.includes('/zh_CN/') || path.includes('/zh-cn/')) ? 'zh_CN' : 'en';
    }

    function irsimSwitchLang(targetLang) {
        const url = new URL(window.location.href);
        const currentLang = irsimDetectLang();
        
        if (targetLang === currentLang) {
            return;
        }

        const isLocal = window.location.hostname === 'localhost' || 
                        window.location.hostname === '127.0.0.1' || 
                        window.location.protocol === 'file:';

        if (targetLang === 'zh_CN') {
            if (isLocal) {
                if (url.pathname.includes('/html/')) {
                    url.pathname = url.pathname.replace('/html/', '/zh_CN/');
                } else {
                    url.pathname = url.pathname.replace('/en/', '/zh_CN/');
                }
            } else {
                // RTD: replace /en/ with /zh-cn/
                url.pathname = url.pathname.replace('/en/', '/zh-cn/');
            }
        } else {
            // Target is English
            if (isLocal) {
                url.pathname = url.pathname.replace('/zh_CN/', '/html/');
            } else {
                // RTD: replace /zh-cn/ with /en/
                url.pathname = url.pathname.replace('/zh-cn/', '/en/').replace('/zh_CN/', '/en/');
            }
        }

        url.search = '';
        window.location.href = url.toString();
    }
</script>
